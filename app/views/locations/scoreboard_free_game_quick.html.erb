<%# Ultra-Simple Quick Game Page - Optimized for Raspberry Pi 3 %>
<%# No Alpine.js - Minimal JavaScript - Fast Performance %>
<style>
  .preset-card {
    padding: 30px;
    margin: 15px;
    border: 3px solid #gray;
    border-radius: 15px;
    cursor: pointer;
    transition: all 0.2s;
    background: white;
    color: black;
  }
  .preset-card:hover {
    background: #3b82f6;
    color: white;
    border-color: #2563eb;
  }
  .preset-card.selected {
    background: #10b981;
    color: white;
    border-color: #059669;
  }
  .preset-title {
    font-size: 28px;
    font-weight: bold;
    margin-bottom: 10px;
  }
  .preset-details {
    font-size: 18px;
  }
</style>

<div class="p-4 w-full m-auto flex items-center flex-col bg-cover h-screen bg-center bg-no-repeat"
     style="background-image: url('<%= @location.background_image.gsub(".", "-.") %>')">
  
  <h1 style="text-shadow: 2px 2px #000000" class="text-5vw flex text-gray-300 mb-8">
    <%= "#{table.andand.table_kind.andand.name} - #{table.andand.name}" %>
  </h1>
  
  <h2 style="text-shadow: 2px 2px #000000" class="text-3vw flex text-gray-300 mb-8">
    Schnellstart - Freies Spiel
  </h2>

  <%= form_tag start_game_table_monitor_path(table_monitor), data: {turbo: false}, method: :post, class: "flex flex-col w-full max-w-4xl" do %>
    <input name='quick_game_form' value='karambol' type='hidden'/>
    <input id='selected_preset' name='preset' type='hidden'/>
    
    <%# Player Selection %>
    <div class="bg-white dark:bg-gray-800 rounded-lg p-6 mb-6 text-gray-900 dark:text-white">
      <h3 class="text-2xl font-bold mb-4">1. Spieler auswählen</h3>
      <div class="grid grid-cols-2 gap-6">
        <div>
          <label class="block mb-2 font-bold">Spieler A:</label>
          <%= select_tag :player_a_id,
            options_for_select(Array(players), player_a.andand.id || default_guest_a.player.id),
            class: "w-full p-3 text-xl border-2 rounded" %>
        </div>
        <div>
          <label class="block mb-2 font-bold">Spieler B:</label>
          <%= select_tag :player_b_id,
            options_for_select(Array(players), player_b.andand.id || default_guest_b.player.id),
            class: "w-full p-3 text-xl border-2 rounded" %>
        </div>
      </div>
    </div>

    <%# Preset Selection %>
    <div class="bg-white dark:bg-gray-800 rounded-lg p-6 mb-6">
      <h3 class="text-2xl font-bold mb-4 text-gray-900 dark:text-white">2. Spielvariante wählen</h3>
      <div id="preset-container" class="grid grid-cols-2 gap-4">
        <%- presets = Rails.application.config_for(:carambus)['free_game_presets'] || [] %>
        <%- presets.each_with_index do |preset, idx| %>
          <div class="preset-card" data-preset-index="<%= idx %>" data-preset='<%= preset.to_json %>'>
            <div class="preset-title"><%= preset['name'] %></div>
            <div class="preset-details">
              Disziplin: <%= preset['discipline'] %><br>
              Punktziel: <%= preset['balls_goal'] %><br>
              <% if preset['sets_to_win'] && preset['sets_to_win'] > 0 %>
                Best of <%= preset['sets_to_win'] * 2 + 1 %> Sätze
              <% end %>
            </div>
          </div>
        <%- end %>
        
        <%# Custom Option - Link to full configuration page %>
        <div class="preset-card" style="background: #f59e0b; color: white;">
          <div class="preset-title">Eigene Einstellung</div>
          <div class="preset-details">
            <%= link_to "→ Zur Detail-Konfiguration", 
                location_path(@location.md5, 
                  sb_state: "free_game_detail", 
                  table_id: table.id,
                  :"data-turbo" => false),
                style: "color: white; text-decoration: underline;", 
                data: { turbo: false } %>
          </div>
        </div>
      </div>
    </div>

    <%# Start Button %>
    <div class="flex justify-center mt-4">
      <%= submit_tag "Spiel starten", 
          id: "start-game-btn",
          disabled: true,
          class: "px-12 py-6 text-3xl font-bold rounded-lg bg-gray-400 text-gray-600 cursor-not-allowed",
          data: { enabled_class: "bg-green-500 text-white hover:bg-green-600 cursor-pointer", disabled_class: "bg-gray-400 text-gray-600 cursor-not-allowed" } %>
    </div>
    
    <%# Back Link %>
    <div class="flex justify-center mt-4">
      <%= link_to "← Zurück", 
          location_path(@location.md5, sb_state: "start", table_id: table.id, :"data-turbo" => false),
          class: "text-white text-xl underline",
          data: { turbo: false } %>
    </div>
  <% end %>
</div>

<script>
  // Simple preset selection - No Alpine.js, ultra-fast on Pi 3!
  document.addEventListener('DOMContentLoaded', function() {
    var presetCards = document.querySelectorAll('.preset-card[data-preset-index]');
    var selectedPresetInput = document.getElementById('selected_preset');
    var startBtn = document.getElementById('start-game-btn');
    var selectedIndex = null;
    
    presetCards.forEach(function(card, index) {
      card.addEventListener('click', function() {
        // Remove selection from all cards
        presetCards.forEach(function(c) { c.classList.remove('selected'); });
        
        // Select this card
        card.classList.add('selected');
        selectedIndex = card.dataset.presetIndex;
        selectedPresetInput.value = selectedIndex;
        
        // Enable start button
        startBtn.disabled = false;
        startBtn.className = startBtn.className.replace(
          startBtn.dataset.disabledClass, 
          startBtn.dataset.enabledClass
        );
      });
    });
  });
</script>

