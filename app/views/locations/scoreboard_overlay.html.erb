<% if @game.present? %>
  <% 
    # Get players from game_participations (works with both schemas)
    participations = @game.game_participations.includes(:player).to_a rescue []
    player_a = participations.find { |gp| gp.role.to_s.downcase.in?(['playera', 'heim', 'home']) }&.player
    player_b = participations.find { |gp| gp.role.to_s.downcase.in?(['playerb', 'gast', 'guest']) }&.player
    
    # Fallback to first two players if roles not found
    player_a ||= participations.first&.player
    player_b ||= participations.second&.player
    
    # Get scores from data hash or attributes
    score_a = @game.data.dig('Ergebnis1') || @game.data.dig('score_a') || 0
    score_b = @game.data.dig('Ergebnis2') || @game.data.dig('score_b') || 0
  %>
  
  <div class="overlay-container" data-controller="streaming-overlay" data-streaming-overlay-table-id-value="<%= @table&.id %>">
    <!-- Player A -->
    <div class="player-section">
      <div class="player-name">
        <%= player_a&.fl_name || "#{player_a&.firstname} #{player_a&.lastname}".strip.presence || "Spieler 1" %>
      </div>
      <div class="player-score" data-streaming-overlay-target="scoreA">
        <%= score_a %>
      </div>
    </div>
    
    <!-- VS Section -->
    <div class="vs-section">
      <div class="vs-text">
        <span class="live-indicator"></span>VS
      </div>
      <% if @tournament.present? %>
        <div class="tournament-info">
          <%= @tournament.try(:title)&.truncate(30) || @tournament.try(:name)&.truncate(30) || "Turnier" %>
        </div>
      <% end %>
    </div>
    
    <!-- Player B -->
    <div class="player-section">
      <div class="player-name">
        <%= player_b&.fl_name || "#{player_b&.firstname} #{player_b&.lastname}".strip.presence || "Spieler 2" %>
      </div>
      <div class="player-score" data-streaming-overlay-target="scoreB">
        <%= score_b %>
      </div>
    </div>
    
    <!-- Table Info -->
    <div class="table-info">
      Tisch <%= @table&.number || "?" %> • <%= @location&.name %>
    </div>
  </div>
<% else %>
  <!-- No active game -->
  <div class="no-game">
    <div class="no-game-title">
      <%= @location&.name || "Carambus" %>
    </div>
    <div class="no-game-subtitle">
      Tisch <%= @table&.number || "?" %> • Kein aktives Spiel
    </div>
  </div>
<% end %>


