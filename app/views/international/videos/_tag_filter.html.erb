<div class="bg-white rounded-lg shadow-md p-6 mb-8">
  <h3 class="text-lg font-semibold text-gray-900 mb-4 flex items-center">
    <svg class="w-5 h-5 mr-2 text-blue-600" fill="currentColor" viewBox="0 0 20 20">
      <path fill-rule="evenodd" d="M17.707 9.293a1 1 0 010 1.414l-7 7a1 1 0 01-1.414 0l-7-7A.997.997 0 012 10V5a3 3 0 013-3h5c.256 0 .512.098.707.293l7 7zM5 6a1 1 0 100-2 1 1 0 000 2z" clip-rule="evenodd"/>
    </svg>
    Filter by Tags
  </h3>

  <!-- Active Tags Display -->
  <% if params[:tag].present? || params[:tags].present? %>
    <div class="mb-4 p-3 bg-blue-50 rounded-lg">
      <div class="flex items-center justify-between mb-2">
        <span class="text-sm font-medium text-blue-900">Active Filters:</span>
        <%= link_to 'Clear All', international_videos_path(params.except(:tag, :tags, :tag_group, :tag_group_value)), 
            class: 'text-sm text-blue-600 hover:text-blue-800 font-medium' %>
      </div>
      <div class="flex flex-wrap gap-2">
        <% active_tags = [params[:tag], params[:tags]].flatten.compact %>
        <% active_tags.each do |tag| %>
          <%= link_to international_videos_path(params.except(:tag, :tags).merge(tags: active_tags - [tag])),
              class: "inline-flex items-center px-3 py-1 text-sm font-medium rounded-full transition-colors #{video_tag_badge_class(tag)}" do %>
            <%= tag.titleize %>
            <svg class="ml-1 w-4 h-4" fill="currentColor" viewBox="0 0 20 20">
              <path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd"/>
            </svg>
          <% end %>
        <% end %>
      </div>
    </div>
  <% end %>

  <!-- Content Type Tags -->
  <div class="mb-6">
    <h4 class="text-sm font-semibold text-gray-700 mb-3 flex items-center">
      <span class="mr-2">üé¨</span>
      Content Type
    </h4>
    <div class="flex flex-wrap gap-2">
      <% InternationalHelper::VIDEO_TAG_GROUPS['Content Type'][:tags].each do |tag| %>
        <% count = @tag_counts.dig(:content_types, tag) || 0 %>
        <% is_active = params[:tag] == tag %>
        <%= link_to international_videos_path(params.except(:tag, :tags, :tag_group, :tag_group_value).merge(tag: tag)),
            class: "inline-flex items-center px-3 py-1.5 text-sm font-medium rounded-full transition-all #{is_active ? video_tag_badge_class(tag) + ' ring-2 ring-offset-2 ring-blue-500' : 'bg-gray-100 text-gray-700 hover:bg-gray-200'}" do %>
          <%= tag.titleize %>
          <% if count > 0 %>
            <span class="ml-1.5 px-1.5 py-0.5 text-xs <%= is_active ? 'bg-white bg-opacity-30' : 'bg-gray-200' %> rounded-full">
              <%= count %>
            </span>
          <% end %>
        <% end %>
      <% end %>
    </div>
  </div>

  <!-- Top Players Tags -->
  <div class="mb-6">
    <h4 class="text-sm font-semibold text-gray-700 mb-3 flex items-center">
      <span class="mr-2">‚≠ê</span>
      Top Players
      <span class="ml-auto text-xs text-gray-500 font-normal">(Top 20 with videos)</span>
    </h4>
    
    <!-- Quick Country Filter -->
    <div class="mb-3">
      <div class="text-xs font-medium text-gray-600 mb-2">Filter by Country:</div>
      <div class="flex flex-wrap gap-1">
        <% InternationalHelper.player_tags_by_country.keys.sort.each do |country| %>
          <% player_count = InternationalHelper.player_tags_by_country[country].size %>
          <%= link_to international_videos_path(params.except(:tag, :tags).merge(tag_group: 'player_country', tag_group_value: country)),
              class: "inline-flex items-center px-2 py-1 text-xs font-medium bg-gray-100 hover:bg-gray-200 text-gray-700 rounded transition-colors" do %>
            <%= country %>
            <span class="ml-1 text-gray-500">(<%=player_count%>)</span>
          <% end %>
        <% end %>
      </div>
    </div>

    <!-- Player Tags -->
    <div class="flex flex-wrap gap-2">
      <% @tag_counts[:players].take(20).each do |tag, count| %>
        <% player_info = InternationalHelper::WORLD_CUP_TOP_32.find { |k, _| k.downcase == tag } %>
        <% if player_info %>
          <% player_key, player_data = player_info %>
          <% is_active = params[:tag] == tag %>
          <%= link_to international_videos_path(params.except(:tag, :tags, :tag_group, :tag_group_value).merge(tag: tag)),
              class: "inline-flex items-center px-3 py-1.5 text-sm font-medium rounded-full transition-all #{is_active ? 'bg-yellow-100 text-yellow-800 ring-2 ring-offset-2 ring-yellow-500' : 'bg-gray-100 text-gray-700 hover:bg-gray-200'}",
              title: "#{player_data[:full_name]} (#{player_data[:country]}) - Rank ##{player_data[:rank]}" do %>
            <span class="inline-block w-5 text-center mr-1">#<%= player_data[:rank] %></span>
            <%= player_key %>
            <span class="ml-1.5 px-1.5 py-0.5 text-xs <%= is_active ? 'bg-white bg-opacity-30' : 'bg-gray-200' %> rounded-full">
              <%= count %>
            </span>
          <% end %>
        <% end %>
      <% end %>
    </div>

    <% if @tag_counts[:players].size > 20 %>
      <div class="mt-2">
        <button type="button" 
                onclick="this.parentElement.nextElementSibling.classList.toggle('hidden')"
                class="text-sm text-blue-600 hover:text-blue-800 font-medium">
          Show more players (<%= @tag_counts[:players].size - 20 %> more) ‚ñº
        </button>
      </div>
      <div class="hidden mt-3 flex flex-wrap gap-2">
        <% @tag_counts[:players].drop(20).each do |tag, count| %>
          <% player_info = InternationalHelper::WORLD_CUP_TOP_32.find { |k, _| k.downcase == tag } %>
          <% if player_info %>
            <% player_key, player_data = player_info %>
            <% is_active = params[:tag] == tag %>
            <%= link_to international_videos_path(params.except(:tag, :tags, :tag_group, :tag_group_value).merge(tag: tag)),
                class: "inline-flex items-center px-3 py-1.5 text-sm font-medium rounded-full transition-all #{is_active ? 'bg-yellow-100 text-yellow-800 ring-2 ring-offset-2 ring-yellow-500' : 'bg-gray-100 text-gray-700 hover:bg-gray-200'}",
                title: "#{player_data[:full_name]} (#{player_data[:country]}) - Rank ##{player_data[:rank]}" do %>
              <span class="inline-block w-5 text-center mr-1">#<%= player_data[:rank] %></span>
              <%= player_key %>
              <span class="ml-1.5 px-1.5 py-0.5 text-xs <%= is_active ? 'bg-white bg-opacity-30' : 'bg-gray-200' %> rounded-full">
                <%= count %>
              </span>
            <% end %>
          <% end %>
        <% end %>
      </div>
    <% end %>
  </div>

  <!-- Quality Tags -->
  <div>
    <h4 class="text-sm font-semibold text-gray-700 mb-3 flex items-center">
      <span class="mr-2">üé•</span>
      Quality
    </h4>
    <div class="flex flex-wrap gap-2">
      <% InternationalHelper::VIDEO_TAG_GROUPS['Quality'][:tags].each do |tag| %>
        <% count = @tag_counts.dig(:quality, tag) || 0 %>
        <% is_active = params[:tag] == tag %>
        <%= link_to international_videos_path(params.except(:tag, :tags, :tag_group, :tag_group_value).merge(tag: tag)),
            class: "inline-flex items-center px-3 py-1.5 text-sm font-medium rounded-full transition-all #{is_active ? video_tag_badge_class(tag) + ' ring-2 ring-offset-2 ring-indigo-500' : 'bg-gray-100 text-gray-700 hover:bg-gray-200'}" do %>
          <%= tag.upcase %>
          <% if count > 0 %>
            <span class="ml-1.5 px-1.5 py-0.5 text-xs <%= is_active ? 'bg-white bg-opacity-30' : 'bg-gray-200' %> rounded-full">
              <%= count %>
            </span>
          <% end %>
        <% end %>
      <% end %>
    </div>
  </div>

  <!-- Advanced: Multiple Tag Selection (Future Enhancement) -->
  <% if false # Enable when needed %>
    <div class="mt-6 pt-6 border-t border-gray-200">
      <details class="group">
        <summary class="cursor-pointer text-sm font-medium text-gray-700 hover:text-gray-900 flex items-center">
          <span>Advanced: Multiple Tags</span>
          <svg class="ml-2 w-4 h-4 transform group-open:rotate-180 transition-transform" fill="currentColor" viewBox="0 0 20 20">
            <path fill-rule="evenodd" d="M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z" clip-rule="evenodd"/>
          </svg>
        </summary>
        <div class="mt-3 text-sm text-gray-600">
          <p>Select multiple tags to find videos matching any of them (OR logic).</p>
          <div class="mt-2">
            <% # Checkbox-based multi-select would go here %>
          </div>
        </div>
      </details>
    </div>
  <% end %>
</div>
