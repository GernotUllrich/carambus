<div class="container mx-auto px-4 py-8">
  <!-- Breadcrumb -->
  <nav class="mb-6 text-sm">
    <%= link_to 'International', international_path, class: 'text-blue-600 hover:text-blue-800' %>
    <span class="mx-2 text-gray-400">/</span>
    <%= link_to 'Videos', international_videos_path, class: 'text-blue-600 hover:text-blue-800' %>
    <span class="mx-2 text-gray-400">/</span>
    <span class="text-gray-600"><%= truncate(@video.title, length: 50) %></span>
  </nav>

  <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
    <!-- Main Content -->
    <div class="lg:col-span-2">
      <!-- Video Player -->
      <div class="bg-black rounded-lg overflow-hidden mb-6">
        <div class="relative" style="padding-bottom: 56.25%;">
          <% if @video.international_source&.source_type == 'kozoom' %>
            <% if @video.thumbnail_url.present? %>
              <%= image_tag @video.thumbnail_url, class: "absolute inset-0 w-full h-full object-cover", style: "filter: brightness(0.4) grayscale(50%);", alt: "Kozoom Event Thumbnail" %>
            <% end %>
            <div class="absolute inset-0 flex flex-col items-center justify-center text-center p-4">
              <span class="inline-flex items-center px-4 py-1 rounded-full text-sm font-semibold tracking-wider bg-[#FF0000] text-white uppercase shadow-lg shadow-red-900/50 mb-6 drop-shadow-md">
                <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                  <path fill-rule="evenodd" d="M10 2a4 4 0 00-4 4v1H5a1 1 0 00-.994.89l-1 9A1 1 0 004 18h12a1 1 0 00.994-1.11l-1-9A1 1 0 0015 7h-1V6a4 4 0 00-4-4zm2 5V6a2 2 0 10-4 0v1h4zm-6 3a1 1 0 112 0 1 1 0 01-2 0zm7-1a1 1 0 100 2 1 1 0 000-2z" clip-rule="evenodd" />
                </svg>
                Premium Content
              </span>
              
              <h3 class="text-white font-bold text-2xl lg:text-3xl mb-4 drop-shadow-lg max-w-2xl"><%= @video.title %></h3>
              <p class="text-gray-200 text-sm lg:text-base font-medium mb-8 max-w-xl drop-shadow-md">This video is securely hosted on Kozoom TV. A premium subscription may be required to watch.</p>
              
              <a href="<%= @video.watch_url %>" target="_blank" rel="noopener noreferrer" class="group relative inline-flex items-center justify-center px-8 py-4 font-bold text-white transition-all duration-200 bg-red-600 rounded-xl hover:bg-red-500 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-red-600 focus:ring-offset-gray-900 overflow-hidden">
                <span class="relative z-10 flex items-center">
                  <svg class="w-6 h-6 mr-3 transition-transform group-hover:scale-110" fill="currentColor" viewBox="0 0 24 24">
                    <path d="M23.498 6.186a3.016 3.016 0 0 0-2.122-2.136C19.505 3.545 12 3.545 12 3.545s-7.505 0-9.377.505A3.017 3.017 0 0 0 .502 6.186C0 8.07 0 12 0 12s0 3.93.502 5.814a3.016 3.016 0 0 0 2.122 2.136c1.871.505 9.376.505 9.376.505s7.505 0 9.377-.505a3.015 3.015 0 0 0 2.122-2.136C24 15.93 24 12 24 12s0-3.93-.502-5.814zM9.545 15.568V8.432L15.818 12l-6.273 3.568z"/>
                  </svg>
                  Watch on Kozoom TV
                  <svg class="w-5 h-5 ml-2 -mr-1 transition-transform group-hover:translate-x-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14" />
                  </svg>
                </span>
                <div class="absolute inset-0 bg-white/20 translate-y-full group-hover:translate-y-0 transition-transform duration-300 ease-in-out"></div>
              </a>
            </div>
          <% else %>
            <iframe
              src="<%= @video.embed_url %>"
              class="absolute inset-0 w-full h-full"
              frameborder="0"
              allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture"
              allowfullscreen>
            </iframe>
          <% end %>
        </div>
      </div>

      <!-- Video Info -->
      <div class="bg-white dark:bg-gray-800 rounded-lg shadow-md p-6 mb-6">
        <!-- Admin Controls -->
        <% if current_user&.admin? %>
          <div class="mb-4 p-3 bg-yellow-50 dark:bg-yellow-900/20 border border-yellow-200 dark:border-yellow-800 rounded-lg flex items-center justify-between">
            <div class="flex items-center">
              <svg class="w-5 h-5 text-yellow-600 dark:text-yellow-400 mr-2" fill="currentColor" viewBox="0 0 20 20">
                <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd"/>
              </svg>
              <span class="text-sm font-semibold text-yellow-900 dark:text-yellow-200">
                Admin: 
                <% if @video.hidden? %>
                  <span class="text-red-700 dark:text-red-400">This video is hidden from public view</span>
                <% else %>
                  <span class="text-green-700 dark:text-green-400">This video is publicly visible</span>
                <% end %>
              </span>
            </div>
            <% if @video.hidden? %>
              <%= button_to 'Show Video', unhide_international_video_path(@video), method: :post, 
                  class: 'px-4 py-2 bg-green-600 text-white text-sm font-semibold rounded-lg hover:bg-green-700 transition-colors' %>
            <% else %>
              <%= button_to 'Hide Video', hide_international_video_path(@video), method: :post,
                  data: { confirm: 'Are you sure you want to hide this video from public view?' },
                  class: 'px-4 py-2 bg-red-600 text-white text-sm font-semibold rounded-lg hover:bg-red-700 transition-colors' %>
            <% end %>
          </div>
        <% end %>

        <h1 class="text-2xl font-bold text-gray-900 dark:text-gray-100 mb-4"><%= @video.translated_title(:en) %></h1>
        <% if @video.translated_title(:en) != @video.title %>
          <p class="text-sm text-gray-500 dark:text-gray-400 mb-4">
            Original: <%= @video.title %>
          </p>
        <% end %>

        <!-- Video Tags -->
        <% if @video.tags.present? && @video.tags.any? %>
          <div class="mb-4">
            <div class="text-xs font-semibold text-gray-600 dark:text-gray-400 uppercase tracking-wide mb-2">Tags</div>
            <%= render 'video_tags', video: @video, limit: 10, size: 'sm', show_icon: true, spacing: false %>
          </div>
        <% end %>

        <!-- Metadata Pills -->
        <div class="flex flex-wrap gap-2 mb-4">
          <span class="inline-flex items-center px-3 py-1 text-sm font-semibold text-blue-800 bg-blue-100 rounded-full">
            <%= @video.international_source.name %>
          </span>

          <% if @video.discipline.present? %>
            <span class="inline-flex items-center px-3 py-1 text-sm font-semibold text-green-800 bg-green-100 rounded-full">
              <%= @video.discipline.translated_name(:en) %>
            </span>
          <% end %>

          <% if @video.data['year'].present? && @video.data['year'] > 0 %>
            <span class="inline-flex items-center px-3 py-1 text-sm font-semibold text-purple-800 bg-purple-100 rounded-full">
              <%= @video.data['season'] || @video.data['year'] %>
            </span>
          <% end %>

          <% if @video.data['tournament_type'].present? %>
            <span class="inline-flex items-center px-3 py-1 text-sm font-semibold text-indigo-800 bg-indigo-100 rounded-full">
              <%= @video.data['tournament_type'] %>
            </span>
          <% end %>

          <% if @video.data['round_number'].present? %>
            <span class="inline-flex items-center px-3 py-1 text-sm font-semibold text-pink-800 bg-pink-100 rounded-full">
              Round <%= @video.data['round_number'] %>
            </span>
          <% end %>
        </div>

        <!-- Stats -->
        <div class="grid grid-cols-3 gap-4 py-4 border-t border-b border-gray-200 dark:border-gray-700">
          <div class="text-center">
            <div class="text-2xl font-bold text-gray-900 dark:text-gray-100">
              <%= number_to_human(@video.view_count || 0, precision: 1) %>
            </div>
            <div class="text-sm text-gray-600 dark:text-gray-400">Views</div>
          </div>

          <div class="text-center">
            <div class="text-2xl font-bold text-gray-900 dark:text-gray-100">
              <%= number_to_human(@video.like_count || 0, precision: 1) %>
            </div>
            <div class="text-sm text-gray-600 dark:text-gray-400">Likes</div>
          </div>

          <div class="text-center">
            <div class="text-2xl font-bold text-gray-900 dark:text-gray-100">
              <%= @video.duration_formatted || '--' %>
            </div>
            <div class="text-sm text-gray-600 dark:text-gray-400">Duration</div>
          </div>
        </div>

        <!-- Published Date -->
        <% if @video.published_at.present? %>
          <div class="mt-4 text-sm text-gray-600 dark:text-gray-400">
            Published <%= @video.published_at.strftime('%B %d, %Y') %>
            (<%= time_ago_in_words(@video.published_at) %> ago)
          </div>
        <% end %>

        <!-- Players -->
        <% if @video.data['players'].present? && @video.data['players'].any? %>
          <div class="mt-6">
            <h3 class="text-lg font-semibold text-gray-900 dark:text-gray-100 mb-3">Players</h3>
            <div class="flex items-center justify-center py-4 bg-gray-50 dark:bg-gray-700 rounded-lg">
              <div class="text-center">
                <div class="text-xl font-bold text-gray-900 dark:text-gray-100"><%= @video.data['players'][0] %></div>
              </div>
              <div class="mx-6 text-2xl font-bold text-gray-400">vs</div>
              <div class="text-center">
                <div class="text-xl font-bold text-gray-900 dark:text-gray-100"><%= @video.data['players'][1] %></div>
              </div>
            </div>
          </div>
        <% end %>

        <!-- Suggested Tags (for admin/debugging) -->
        <% if @video.suggested_tags.present? && @video.suggested_tags.any? %>
          <div class="mt-6 p-4 bg-yellow-50 border border-yellow-200 rounded-lg">
            <h3 class="text-sm font-semibold text-yellow-900 mb-2 flex items-center">
              <svg class="w-4 h-4 mr-1" fill="currentColor" viewBox="0 0 20 20">
                <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd"/>
              </svg>
              Suggested Tags (Auto-Detected)
            </h3>
            <div class="flex flex-wrap gap-2">
              <% @video.suggested_tags.each do |tag| %>
                <span class="inline-flex items-center px-2 py-1 text-xs font-medium <%= video_tag_badge_class(tag) %> opacity-75">
                  <%= tag.titleize %>
                </span>
              <% end %>
            </div>
            <p class="mt-2 text-xs text-yellow-700">
              These tags were automatically detected but not yet applied.
              <% if false # Enable when admin interface is ready %>
                <%= link_to 'Apply all', '#', class: 'font-medium underline hover:no-underline' %>
              <% end %>
            </p>
          </div>
        <% end %>

        <!-- Description -->
        <% if @video.description.present? %>
          <div class="mt-6">
            <h3 class="text-lg font-semibold text-gray-900 dark:text-gray-100 mb-3">Description</h3>
            <div class="text-gray-700 dark:text-gray-300 whitespace-pre-line">
              <%= truncate(@video.description, length: 500) %>
            </div>
          </div>
        <% end %>

        <!-- Watch on Source Platform -->
        <div class="mt-6">
          <a href="<%= @video.watch_url %>"
             target="_blank"
             rel="noopener noreferrer"
             class="inline-flex items-center px-6 py-3 bg-red-600 text-white font-semibold rounded-lg hover:bg-red-700 transition-colors">
            <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 24 24">
              <path d="M23.498 6.186a3.016 3.016 0 0 0-2.122-2.136C19.505 3.545 12 3.545 12 3.545s-7.505 0-9.377.505A3.017 3.017 0 0 0 .502 6.186C0 8.07 0 12 0 12s0 3.93.502 5.814a3.016 3.016 0 0 0 2.122 2.136c1.871.505 9.376.505 9.376.505s7.505 0 9.377-.505a3.015 3.015 0 0 0 2.122-2.136C24 15.93 24 12 24 12s0-3.93-.502-5.814zM9.545 15.568V8.432L15.818 12l-6.273 3.568z"/>
            </svg>
            Watch on <%= @video.international_source&.name&.split(' ')&.first || 'Platform' %>
          </a>
        </div>
      </div>

      <!-- Tournament Info -->
      <% if @video.videoable_type == 'Tournament' && @video.videoable.present? %>
        <div class="bg-white dark:bg-gray-800 rounded-lg shadow-md p-6">
          <h2 class="text-xl font-bold text-gray-900 dark:text-gray-100 mb-4">Tournament</h2>
          <a href="<%= international_tournament_path(@video.videoable) %>"
             class="block p-4 border border-gray-200 dark:border-gray-700 rounded-lg hover:border-blue-500 hover:bg-blue-50 dark:hover:bg-gray-700 transition-all">
            <h3 class="text-lg font-semibold text-gray-900 dark:text-gray-100 mb-2">
              <%= @video.videoable.name %>
            </h3>
            <div class="text-sm text-gray-600 dark:text-gray-400 space-y-1">
              <p><%= @video.videoable.tournament_type&.humanize %></p>
              <p><%= @video.videoable.date_range %></p>
              <% if @video.videoable.location.present? %>
                <p><%= @video.videoable.location %></p>
              <% end %>
            </div>
          </a>
        </div>
      <% end %>
    </div>

    <!-- Sidebar -->
    <div class="lg:col-span-1">
      <!-- Related Videos -->
      <% if @related_videos.any? %>
        <div class="bg-white dark:bg-gray-800 rounded-lg shadow-md p-6">
          <h2 class="text-xl font-bold text-gray-900 dark:text-gray-100 mb-4">Related Videos</h2>
          <div class="space-y-4">
            <% @related_videos.each do |related_video| %>
              <a href="<%= international_video_path(related_video) %>"
                 class="block hover:bg-gray-50 dark:hover:bg-gray-700 rounded-lg transition-colors">
                <div class="flex gap-3">
                  <% if related_video.thumbnail_url.present? %>
                    <div class="flex-shrink-0 w-32 h-18 relative">
                      <%= image_tag related_video.thumbnail_url,
                          class: 'w-full h-full object-cover rounded',
                          alt: related_video.title %>
                      <% if related_video.duration.present? %>
                        <span class="absolute bottom-1 right-1 bg-black bg-opacity-75 text-white text-xs px-1 py-0.5 rounded">
                          <%= related_video.duration_formatted %>
                        </span>
                      <% end %>
                    </div>
                  <% end %>
                  <div class="flex-1 min-w-0">
                    <h3 class="text-sm font-semibold text-gray-900 dark:text-gray-100 line-clamp-2 mb-1">
                      <%= related_video.translated_title(:en) %>
                    </h3>
                    <p class="text-xs text-gray-600 dark:text-gray-400">
                      <%= related_video.international_source.name %>
                    </p>
                    <% if related_video.published_at.present? %>
                      <p class="text-xs text-gray-500 dark:text-gray-500">
                        <%= time_ago_in_words(related_video.published_at) %> ago
                      </p>
                    <% end %>
                  </div>
                </div>
              </a>
            <% end %>
          </div>

          <div class="mt-4 pt-4 border-t border-gray-200 dark:border-gray-700">
            <%= link_to 'View All Videos â†’',
                international_videos_path,
                class: 'text-blue-600 dark:text-blue-400 hover:text-blue-800 dark:hover:text-blue-300 font-semibold text-sm' %>
          </div>
        </div>
      <% end %>
    </div>
  </div>
</div>
