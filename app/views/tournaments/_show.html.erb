<div class="container mx-auto my-8 px-4">
  <div class="max-w-3xl mx-auto">
    <div class="flex-col justify-between items-center mb-4">
      <h1 class="h3"><%= custom_link_to t('home.index.tournaments'), tournaments_path %> &gt; <%= tournament.title %>
        - <%= tournament.organizer.shortname %> - <%= tournament.season.name %></h1>
      <h3><%= subtitle %></h3>
      <% if local_server? %>
        <%= button_to('Edit', edit_tournament_path(tournament), method: :get, disabled: !current_user&.admin?, class: "btn btn-link") %>
      <% end %>
    </div>
    <%- unless local_assigns[:drop_details].present? %>
      <div class="flex flex-wrap space-y-5  rounded shadow p-8">
        <div class="w-3/12 mb-4 m-w-full pr-8"><h5><%= t('activerecord.attributes.tournament.title') %></h5><%= tournament.title %></div>
        <div class="w-3/12 mb-4 <%= "border-4 border-red-500" if tournament.discipline.blank? %> m-w-full pr-8">
          <h5><%= t('tournaments.show.discipline') %></h5><%= (custom_link_to(tournament.discipline.name, discipline_path(tournament.discipline)) if tournament.discipline.present?) %>
        </div>
        <% if tournament.modus.present? %>
          <div class="w-3/12 mb-4 m-w-full pr-8"><h5><%= t('activerecord.attributes.tournament.modus') %></h5><%= tournament.modus %></div>
        <% end %>
        <% if tournament.age_restriction.present? %>
          <div class="w-3/12 mb-4 m-w-full pr-8">
            <h5><%= t('activerecord.attributes.tournament.age_restriction') %></h5><%= tournament.age_restriction %></div>
        <% end %>
        <div class="w-3/12 mb-4 m-w-full pr-8"><h5><%= t('activerecord.attributes.tournament.date') %></h5><%= tournament.date %></div>
        <div class="w-3/12 mb-4 m-w-full pr-8">
          <h5><%= t('activerecord.attributes.tournament.accredation_end') %></h5><%= tournament.accredation_end %></div>
        <div class="w-3/12 mb-4 m-w-full pr-8">
          <h5><%= t('activerecord.attributes.tournament.location') %></h5><%= custom_link_to tournament.location.display_address, location_path(tournament.location) if tournament.location.present? %>
        </div>
        <div class="w-3/12 mb-4 m-w-full pr-8">
          <h5><%= t('activerecord.attributes.tournament.season') %></h5><%= custom_link_to(tournament.season.name, season_path(tournament.season)) %>
        </div>
        <div class="w-3/12 mb-4 m-w-full pr-8">
          <h5><%= t('activerecord.attributes.tournament.organizer') %></h5><%= custom_link_to(tournament.organizer.name, tournament.organizer) %>
        </div>
        <% if tournament.end_date.present? %>
          <div class="w-3/12 mb-4 m-w-full pr-8"><h5><%= t('activerecord.attributes.tournament.end_date') %></h5><%= tournament.end_date %></div>
        <% end %>
        <div class="w-3/12 mb-4 m-w-full pr-8"><h5><%= t('activerecord.attributes.tournament.shortname') %></h5><%= tournament.shortname %></div>
        <% if tournament.data.present? && tournament_director?(current_user) %>
          <div class="w-3/12 mb-4 m-w-full pr-8">
            <h5><%= t('activerecord.attributes.tournament.data') %></h5>
            <button type="button" 
                    onclick="document.getElementById('tournament-data-modal-<%= tournament.id %>').classList.remove('hidden')"
                    class="btn btn-sm btn-secondary cursor-pointer">
              Turnierdaten anzeigen
            </button>
          </div>
          
          <!-- Modal Popup f√ºr Turnier-Daten -->
          <div id="tournament-data-modal-<%= tournament.id %>" 
               class="hidden fixed inset-0 z-50 overflow-y-auto">
            <div class="flex items-center justify-center min-h-screen px-4 pt-4 pb-20 text-center sm:block sm:p-0">
              <!-- Hintergrund Overlay -->
              <div class="fixed inset-0 transition-opacity bg-gray-500 bg-opacity-75"></div>
              
              <!-- Modal Content - Volle Breite √ºber alle 4 Spalten -->
              <div class="inline-block w-full max-w-7xl p-6 my-8 overflow-hidden text-left align-middle transition-all transform bg-white shadow-xl rounded-lg">
                <!-- Header -->
                <div class="flex items-center justify-between pb-4 border-b border-gray-200">
                  <h3 class="text-2xl font-bold text-gray-900">
                    üìä Turnier-Daten: <%= tournament.title %>
                  </h3>
                  <button type="button"
                          class="text-gray-400 hover:text-gray-600 transition-colors close-modal-btn">
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                    </svg>
                  </button>
                </div>
                
                <!-- Content -->
                <div class="mt-4 overflow-auto max-h-[70vh]">
                  <pre class="p-4 bg-gray-50 rounded-lg text-sm font-mono whitespace-pre-wrap break-words"><%= JSON.pretty_generate(tournament.data) %></pre>
                </div>
                
                <!-- Footer -->
                <div class="flex justify-end mt-6 pt-4 border-t border-gray-200">
                  <button type="button"
                          class="btn btn-primary close-modal-btn">
                    Schlie√üen
                  </button>
                </div>
              </div>
            </div>
          </div>
          
          <!-- JavaScript f√ºr ESC-Taste Unterst√ºtzung -->
          <script>
            (function() {
              const modalId = 'tournament-data-modal-<%= tournament.id %>';
              const modal = document.getElementById(modalId);
              if (!modal) return;
              
              // ESC-Taste Handler
              function handleEscape(event) {
                if (event.key === 'Escape' && !modal.classList.contains('hidden')) {
                  modal.classList.add('hidden');
                  document.removeEventListener('keydown', handleEscape);
                }
              }
              
              // Beim √ñffnen: ESC-Listener hinzuf√ºgen (wenn Modal noch nicht ge√∂ffnet war)
              const openButton = document.querySelector('[onclick*="tournament-data-modal-<%= tournament.id %>"]');
              if (openButton) {
                openButton.addEventListener('click', function() {
                  setTimeout(function() {
                    document.addEventListener('keydown', handleEscape);
                  }, 100);
                });
              }
              
              // Schlie√üen-Funktion
              function closeModal() {
                modal.classList.add('hidden');
                document.removeEventListener('keydown', handleEscape);
              }
              
              // Alle Schlie√üen-Buttons verbinden
              modal.addEventListener('click', function(event) {
                if (event.target.classList.contains('close-modal-btn') || 
                    event.target.closest('.close-modal-btn') ||
                    event.target.classList.contains('bg-gray-500') ||
                    event.target === modal) {
                  closeModal();
                }
              });
            })();
          </script>
        <% end %>
        <% if tournament.ba_state.present? %>
          <div class="w-3/12 mb-4 m-w-full pr-8"><h5><%= t('activerecord.attributes.tournament.ba_state') %></h5><%= tournament.ba_state %></div>
        <% end %>
        <% if tournament.player_class.present? %>
          <div class="w-3/12 <%= "border-4 border-red-500" if tournament.player_class.blank? %> mb-4 m-w-full pr-8">
            <h5><%= t('activerecord.attributes.tournament.player_class') %></h5><%= tournament.player_class %></div>
        <% end %>
        <%- if tournament.tournament_plan.present? %>
          <div class="w-3/12 mb-4 m-w-full pr-8"><h5><%= I18n.t("tournaments.show.final_tournament_mode") %></h5>
            <%= custom_link_to(tournament.tournament_plan.name, tournament_plan_path(tournament.tournament_plan)) %>
            : <%= tournament.tournament_plan.rulesystem %>
          </div>
        <%- end %>
        <% if tournament.innings_goal.present? %>
          <div class="w-3/12 mb-4 m-w-full pr-8"><h5><%= t('activerecord.attributes.tournament.innings_goal') %></h5><%= tournament.innings_goal %>
          </div>
        <% end %>
        <% if tournament.tournament_monitor.present? %>
          <div class="w-3/12 mb-4 m-w-full pr-8"><h5><%= t('activerecord.attributes.tournament.balls_goal') %></h5><%= tournament.balls_goal %></div>
          <div class="w-3/12 mb-4 m-w-full pr-8"><h5><%= t('activerecord.attributes.tournament.timeouts') %></h5><%= tournament.timeouts %></div>
          <div class="w-3/12 mb-4 m-w-full pr-8"><h5><%= t('activerecord.attributes.tournament.timeout') %></h5><%= tournament.timeout %></div>
          <div class="w-3/12 mb-4 m-w-full pr-8">
            <h5><%= t('activerecord.attributes.tournament.handicap_tournier') %></h5><%= tournament.handicap_tournier %></div>
          <div class="w-3/12 mb-4 m-w-full pr-8"><h5><%= t('activerecord.attributes.tournament.sets_to_win') %></h5><%= tournament.sets_to_win %>
          </div>
          <div class="w-3/12 mb-4 m-w-full pr-8"><h5><%= t('activerecord.attributes.tournament.sets_to_play') %></h5><%= tournament.sets_to_play %>
          </div>
          <div class="w-3/12 mb-4 m-w-full pr-8"><h5><%= t('activerecord.attributes.tournament.team_size') %></h5><%= tournament.team_size %></div>
          <div class="w-3/12 mb-4 m-w-full pr-8">
            <h5><%= t('activerecord.attributes.tournament.kickoff_switches_with') %></h5><%= tournament.kickoff_switches_with %></div>
          <div class="w-3/12 mb-4 m-w-full pr-8">
            <h5><%= t('activerecord.attributes.tournament.allow_follow_up') %></h5><%= tournament.allow_follow_up %></div>
          <div class="w-3/12 mb-4 m-w-full pr-8">
            <h5><%= t('activerecord.attributes.tournament.fixed_display_left') %></h5><%= tournament.fixed_display_left.presence || "Kick-Off Player" %>
          </div>
          <div class="w-3/12 mb-4 m-w-full pr-8">
            <h5><%= t('activerecord.attributes.tournament.color_remains_with_set') %></h5><%= tournament.color_remains_with_set %></div>
        <% end %>
        <div class="w-3/12 mb-4 m-w-full pr-8">
          <h5><%= t('activerecord.attributes.tournament.source') %></h5><%= link_to_if tournament.source_url.present?, tournament.source_url.present? ? URI.parse(tournament.source_url).host : "", tournament.source_url, class: "green_link", target: :_blank %>
        </div>
        <div class="w-3/12 mb-4 m-w-full pr-8"><h5><%= "Last Sync:" %></h5><%= tournament.sync_date.andand.to_date %></div>
      </div>
      </div>
    <%- end %>
    </div>
