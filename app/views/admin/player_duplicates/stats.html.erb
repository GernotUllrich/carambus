<% content_for(:title) do %>
  Player Duplicates Statistics
<% end %>

<header class="main-content__header">
  <h1 class="main-content__page-title">Player Duplicates Statistics</h1>
  <%= link_to "← Back to Review", admin_player_duplicates_path, class: "btn btn-secondary" %>
</header>

<section class="main-content__body">
  <!-- Overall Stats -->
  <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-6">
    <div class="bg-white border rounded-lg p-6">
      <h3 class="text-sm text-gray-600 mb-2">Total Players</h3>
      <p class="text-3xl font-bold"><%= number_with_delimiter(@total_players) %></p>
    </div>
    
    <div class="bg-white border rounded-lg p-6">
      <h3 class="text-sm text-gray-600 mb-2">Duplicate Names</h3>
      <p class="text-3xl font-bold text-orange-600"><%= number_with_delimiter(@total_duplicate_fl_names) %></p>
      <p class="text-xs text-gray-500 mt-1">
        <%= ((@total_duplicate_fl_names.to_f / @total_players) * 100).round(1) %>% of players
      </p>
    </div>
    
    <div class="bg-white border rounded-lg p-6">
      <h3 class="text-sm text-gray-600 mb-2">Total Duplicate Records</h3>
      <p class="text-3xl font-bold text-red-600"><%= number_with_delimiter(@total_duplicate_records) %></p>
      <p class="text-xs text-gray-500 mt-1">
        <%= ((@total_duplicate_records.to_f / @total_players) * 100).round(1) %>% of players
      </p>
    </div>
  </div>

  <!-- Progress from Today -->
  <div class="bg-gradient-to-r from-green-50 to-blue-50 border border-green-200 rounded-lg p-6 mb-6">
    <h3 class="text-xl font-bold mb-4">Today's Progress</h3>
    
    <div class="space-y-3">
      <div class="flex items-center justify-between">
        <span class="text-sm">Start (this morning):</span>
        <span class="font-semibold">4,061 duplicate fl_names</span>
      </div>
      
      <div class="w-full bg-gray-200 rounded-full h-4">
        <% progress = ((4061 - @total_duplicate_fl_names).to_f / 4061 * 100).round(1) %>
        <div class="bg-green-500 h-4 rounded-full flex items-center justify-center text-xs text-white font-bold" 
             style="width: <%= progress %>%">
          <%= progress %>%
        </div>
      </div>
      
      <div class="flex items-center justify-between">
        <span class="text-sm font-semibold text-green-700">Current:</span>
        <span class="font-bold text-green-700"><%= number_with_delimiter(@total_duplicate_fl_names) %> duplicate fl_names</span>
      </div>
      
      <div class="text-center pt-2 border-t">
        <span class="text-2xl font-bold text-green-600">
          <%= ((4061 - @total_duplicate_fl_names).to_f / 4061 * 100).round(0) %>% Reduction!
        </span>
      </div>
    </div>
  </div>

  <!-- Pattern Analysis -->
  <% if @pattern_stats %>
    <div class="bg-white border rounded-lg p-6 mb-6">
      <h3 class="text-lg font-bold mb-4">Pattern Analysis (Sample of 100)</h3>
      
      <div class="space-y-2">
        <% @pattern_stats.each do |pattern, count| %>
          <div class="flex items-center justify-between p-3 bg-gray-50 rounded">
            <span class="text-sm">
              <%= pattern.to_s.titleize.gsub('_', ' ') %>
            </span>
            <span class="font-semibold"><%= count %></span>
          </div>
        <% end %>
      </div>
      
      <div class="mt-4 pt-4 border-t">
        <p class="text-sm text-gray-600">
          <strong>Note:</strong> Based on a sample of 100 duplicate groups. 
          Patterns help identify which duplicates can be safely merged vs need manual review.
        </p>
      </div>
    </div>
  <% end %>

  <!-- Phase History -->
  <div class="bg-white border rounded-lg p-6">
    <h3 class="text-lg font-bold mb-4">Cleanup History</h3>
    
    <div class="space-y-3">
      <div class="flex items-center justify-between p-3 bg-green-50 rounded">
        <div>
          <div class="font-semibold">Phase 2: Clean Merges</div>
          <div class="text-xs text-gray-600">One master with dbu_nr, duplicates with ba_id > 999000000</div>
        </div>
        <span class="font-bold text-green-700">~2,575 merged</span>
      </div>
      
      <div class="flex items-center justify-between p-3 bg-green-50 rounded">
        <div>
          <div class="font-semibold">Phase 3: Multiple Masters</div>
          <div class="text-xs text-gray-600">Multiple players with same dbu_nr/cc_id</div>
        </div>
        <span class="font-bold text-green-700">~741 merged</span>
      </div>
      
      <div class="flex items-center justify-between p-3 bg-green-50 rounded">
        <div>
          <div class="font-semibold">Phase 4: No Master</div>
          <div class="text-xs text-gray-600">Selected best candidate as master</div>
        </div>
        <span class="font-bold text-green-700">~174 merged</span>
      </div>
      
      <div class="flex items-center justify-between p-3 bg-green-50 rounded">
        <div>
          <div class="font-semibold">Phase 5: Safe Remaining</div>
          <div class="text-xs text-gray-600">Same cc_id, ba_id=dbu_nr, new vs old patterns</div>
        </div>
        <span class="font-bold text-green-700">~516 merged</span>
      </div>
      
      <div class="flex items-center justify-between p-3 bg-blue-50 rounded border-2 border-blue-300">
        <div>
          <div class="font-semibold">Remaining (Manual Review)</div>
          <div class="text-xs text-gray-600">Complex cases needing individual review</div>
        </div>
        <span class="font-bold text-blue-700"><%= @total_duplicate_fl_names %> groups</span>
      </div>
    </div>
  </div>

  <!-- Action Buttons -->
  <div class="mt-6 flex gap-4">
    <%= link_to "Start Manual Review", admin_player_duplicates_path(page: 1), 
        class: "btn btn-primary flex-1" %>
  </div>
</section>

