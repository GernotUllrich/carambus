<%= form_with(model: [:admin, stream_configuration], local: true, class: "space-y-6") do |form| %>
  <% if stream_configuration.errors.any? %>
    <div class="bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded">
      <h2 class="font-bold mb-2"><%= pluralize(stream_configuration.errors.count, "Fehler") %> beim Speichern:</h2>
      <ul class="list-disc list-inside">
        <% stream_configuration.errors.full_messages.each do |message| %>
          <li><%= message %></li>
        <% end %>
      </ul>
    </div>
  <% end %>

  <div class="form-group">
    <!-- Table Selection (Location wird daraus abgeleitet) -->
    <%= form.label :table_id, "Tisch", class: "block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2" %>
    <%= form.select :table_id,
        grouped_options_for_select(
          @locations.map { |loc| [loc.name, loc.tables.map { |t| [t.name, t.id] }] },
          stream_configuration.table_id
        ),
        { include_blank: "Bitte Location und Tisch wÃ¤hlen..." },
        { class: "form-select w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500" } %>
    <p class="mt-1 text-sm text-gray-500">Location wird automatisch vom gewÃ¤hlten Tisch Ã¼bernommen</p>
  </div>

  <!-- YouTube Configuration -->
  <div class="bg-gray-50 dark:bg-gray-800 p-4 rounded-lg">
    <h3 class="text-lg font-semibold mb-4 text-gray-800 dark:text-gray-100">ğŸ¬ YouTube-Konfiguration</h3>
    
    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
      <div class="form-group md:col-span-2">
        <%= form.label :youtube_stream_key, "Stream-Key", class: "block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2" %>
        <%= form.text_field :youtube_stream_key,
            class: "form-input w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500",
            placeholder: "xxxx-yyyy-zzzz-aaaa-bbbb" %>
        <p class="mt-1 text-sm text-gray-500">Aus YouTube Studio â†’ Live-Streaming â†’ Stream-Key kopieren</p>
      </div>

      <div class="form-group md:col-span-2">
        <%= form.label :youtube_channel_id, "Channel-ID (optional)", class: "block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2" %>
        <%= form.text_field :youtube_channel_id,
            class: "form-input w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500",
            placeholder: "UCxxxxxxxxxxxxxxxxxxxxxxxxx" %>
        <p class="mt-1 text-sm text-gray-500">FÃ¼r direkten Link zum Live-Stream</p>
      </div>
    </div>
  </div>

  <!-- Camera Configuration -->
  <div class="bg-gray-50 dark:bg-gray-800 p-4 rounded-lg">
    <h3 class="text-lg font-semibold mb-4 text-gray-800 dark:text-gray-100">ğŸ“· Kamera-Einstellungen</h3>
    
    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
      <div class="form-group">
        <%= form.label :camera_device, "GerÃ¤t", class: "block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2" %>
        <%= form.text_field :camera_device,
            class: "form-input w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500",
            placeholder: "/dev/video0" %>
      </div>

      <div class="form-group">
        <%= form.label :camera_fps, "Framerate (FPS)", class: "block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2" %>
        <%= form.select :camera_fps,
            options_for_select([30, 60], stream_configuration.camera_fps || 60),
            {},
            { class: "form-select w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500" } %>
      </div>

      <div class="form-group">
        <%= form.label :camera_width, "Breite", class: "block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2" %>
        <%= form.number_field :camera_width,
            class: "form-input w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500" %>
      </div>

      <div class="form-group">
        <%= form.label :camera_height, "HÃ¶he", class: "block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2" %>
        <%= form.number_field :camera_height,
            class: "form-input w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500" %>
      </div>
    </div>
  </div>

  <!-- Overlay Configuration -->
  <div class="bg-gray-50 dark:bg-gray-800 p-4 rounded-lg">
    <h3 class="text-lg font-semibold mb-4 text-gray-800 dark:text-gray-100">ğŸ¨ Overlay-Einstellungen</h3>
    
    <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
      <div class="form-group">
        <label class="flex items-center">
          <%= form.check_box :overlay_enabled,
              class: "form-checkbox h-5 w-5 text-blue-600 rounded focus:ring-blue-500" %>
          <span class="ml-2 text-sm font-medium text-gray-700 dark:text-gray-300">Overlay aktiviert</span>
        </label>
      </div>

      <div class="form-group">
        <%= form.label :overlay_position, "Position", class: "block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2" %>
        <%= form.select :overlay_position,
            options_for_select([['Unten', 'bottom'], ['Oben', 'top']], stream_configuration.overlay_position || 'bottom'),
            {},
            { class: "form-select w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500" } %>
      </div>

      <div class="form-group">
        <%= form.label :overlay_height, "HÃ¶he (px)", class: "block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2" %>
        <%= form.number_field :overlay_height,
            class: "form-input w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500" %>
      </div>
    </div>
  </div>

  <!-- Stream Quality -->
  <div class="bg-gray-50 dark:bg-gray-800 p-4 rounded-lg">
    <h3 class="text-lg font-semibold mb-4 text-gray-800 dark:text-gray-100">âš™ï¸ Stream-QualitÃ¤t</h3>
    
    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
      <div class="form-group">
        <%= form.label :video_bitrate, "Video-Bitrate (kbit/s)", class: "block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2" %>
        <%= form.number_field :video_bitrate,
            class: "form-input w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500",
            step: 100 %>
        <p class="mt-1 text-sm text-gray-500">Empfohlen: 2000-2500 fÃ¼r 720p60</p>
      </div>

      <div class="form-group">
        <%= form.label :audio_bitrate, "Audio-Bitrate (kbit/s)", class: "block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2" %>
        <%= form.number_field :audio_bitrate,
            class: "form-input w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500",
            step: 32 %>
      </div>
    </div>
  </div>

  <!-- Network Configuration -->
  <div class="bg-gray-50 dark:bg-gray-800 p-4 rounded-lg">
    <h3 class="text-lg font-semibold mb-4 text-gray-800 dark:text-gray-100">ğŸŒ Netzwerk</h3>
    
    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
      <div class="form-group">
        <%= form.label :raspi_ip, "Raspberry Pi IP-Adresse", class: "block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2" %>
        <%= form.text_field :raspi_ip,
            class: "form-input w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500",
            placeholder: "192.168.1.100" %>
        <p class="mt-1 text-sm text-gray-500">Wird automatisch vom Tisch Ã¼bernommen, falls vorhanden</p>
      </div>

      <div class="form-group">
        <%= form.label :raspi_ssh_port, "SSH-Port", class: "block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2" %>
        <%= form.number_field :raspi_ssh_port,
            class: "form-input w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500" %>
      </div>
    </div>
  </div>

  <!-- Actions -->
  <div class="flex justify-end gap-3">
    <%= link_to "Abbrechen", admin_stream_configurations_path, class: "btn btn-secondary" %>
    <%= form.submit "Speichern", class: "btn btn-primary" %>
  </div>
<% end %>

